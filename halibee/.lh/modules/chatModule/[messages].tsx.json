{
    "sourceFile": "modules/chatModule/[messages].tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1635791974236,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1635791974236,
            "name": "Commit-0",
            "content": "import { onChildAdded, onValue, push, ref, serverTimestamp, update } from \"@firebase/database\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { useAuthState } from \"react-firebase-hooks/auth\";\r\nimport { auth, database } from \"../firebase/initialiseFirebase\";\r\nimport { formatRelative } from \"date-fns\"\r\nimport { GetStaticPaths } from \"next\";\r\n\r\n\r\n// export const getStaticPaths: GetStaticPaths = async () => {\r\n//   const paths = []\r\n//   onValue(ref(database, auth.currentUser.uid), (snapshot) => {\r\n//     if (snapshot.val())\r\n\r\n//     for(var p in snapshot.val()){\r\n//       paths.push(snapshot.val()[p]);\r\n//       }\r\n\r\n\r\n//   });\r\n//   return {\r\n//       paths: paths,\r\n//       fallback: false\r\n//   }\r\n// }\r\n\r\n\r\nexport default function Messages() {\r\n  const dummySpace = useRef();\r\n  const [newMessage, setNewMessage] = useState(\"\")\r\n  const currentUser = auth.currentUser\r\n  const [messages, setMessages] = useState([]);\r\n \r\n\r\n  const handleSubmit = (e) => {\r\n    e.preventDefault()\r\n    push(ref(database, 'messages/'), {\r\n      text: newMessage,\r\n      sender: currentUser.displayName,\r\n      avatar: currentUser.photoURL,\r\n      timeStamp: serverTimestamp()\r\n    })\r\n\r\n    setNewMessage(\"\");\r\n\r\n  }\r\n\r\n  useEffect(() => {\r\n    const messageList = []\r\n    onValue(ref(database, 'messages'), (snapshot) => {\r\n      if (snapshot.val())\r\n\r\n      for(var p in snapshot.val()){\r\n          messageList.push(snapshot.val()[p]);\r\n        }\r\n\r\n        setMessages(messageList)\r\n\r\n    });\r\n\r\n  }, [database]);\r\n\r\n\r\n\r\n  return (\r\n    <div className=\"pt-10 px-3\">\r\n\r\n{messages.length > 0 && <ul >\r\n        {messages.map(message => (\r\n          <li \r\n          className=\" bg-white rounded-lg p-6 my-10 relative\"\r\n          >\r\n            <section>\r\n              \r\n               {message.avatar ? (\r\n                <img\r\n                  src={message.avatar}\r\n                  alt=\"Avatar\"\r\n                  className=\"w-12 h-12 rounded-lg display-block\"\r\n                />\r\n              ) : null}\r\n            </section>\r\n\r\n            <section>\r\n\r\n              <p >{message.text}\r\n              {message.id}\r\n              </p>\r\n\r\n\r\n              {message.sender ? <span className=\"text-primary\">{message.sender}</span> : null}\r\n              <br />\r\n\r\n              {message.timeStamp ? (\r\n                <span className=\"text-gray-600\">\r\n                  {formatRelative(\r\n                    new Date(message.timeStamp),\r\n                    new Date()\r\n                  )}\r\n                </span>\r\n              ) : null}\r\n            </section>\r\n          </li>\r\n        ))}\r\n      \r\n      </ul>}\r\n\r\n\r\n      <form \r\n      onSubmit={handleSubmit}\r\n      className=\" bg-white rounded-lg p-6 my-10 mt-24 relative\"\r\n      >\r\n\r\n        <h3 className=\"text-2xl text-primary text-center dark:text-darkMode font-bold\">\r\n          Messaging\r\n        </h3>\r\n\r\n\r\n        \r\n        <input\r\n          type=\"text\"\r\n          maxLength={91}\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n          className=\" rounded-lg border-transparent flex-1 appearance-none border border-gray-300 w-full py-2 px-4 bg-white text-gray-700 placeholder-gray-400 shadow-sm text-base focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent\"\r\n          placeholder=\"Short description\"\r\n        />\r\n\r\n        <div className=\"relative flex flex-row items-center justify-center min-w-40 break-words w-full mb-8 \">\r\n          <button\r\n            className=\"py-2 px-4 mt-6 bg-primary dark:bg-darkMode text-secondary w-60 text-center text-base font-semibold shadow-lg rounded-lg rounded-lg\"\r\n            type=\"submit\"\r\n            disabled={!newMessage}\r\n          >\r\n            Send\r\n          </button>\r\n\r\n        </div>\r\n      </form>\r\n      \r\n    </div>\r\n  );\r\n}"
        }
    ]
}